{% extends 'base.html' %}
{% block title %}{% if is_update %}Actualizar{% else %}Nuevo{% endif %} Paciente{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{% if is_update %}Actualizar{% else %}Nuevo{% endif %} Paciente</h1>
</div>

<div class="card">
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="first_name" class="form-label">Nombre</label>
                    <input type="text" class="form-control" id="first_name" name="first_name" 
                           value="{% if is_update %}{{ patient.user.first_name }}{% endif %}" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="last_name" class="form-label">Apellido</label>
                    <input type="text" class="form-control" id="last_name" name="last_name" 
                           value="{% if is_update %}{{ patient.user.last_name }}{% endif %}" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="document_id" class="form-label">Documento de Identidad</label>
                    <input type="text" class="form-control" id="document_id" name="document_id" 
                           value="{% if is_update %}{{ patient.user.document_id }}{% endif %}" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="birthdate" class="form-label">Fecha de Nacimiento</label>
                    <input type="date" class="form-control" id="birthdate" name="birthdate" 
                           value="{% if is_update %}{{ patient.birthdate|date:'Y-m-d' }}{% endif %}" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="gender" class="form-label">Género</label>
                    <select class="form-select" id="gender" name="gender" required>
                        <option value="">Seleccione...</option>
                        <option value="M" {% if is_update and patient.gender == 'M' %}selected{% endif %}>Masculino</option>
                        <option value="F" {% if is_update and patient.gender == 'F' %}selected{% endif %}>Femenino</option>
                        <option value="O" {% if is_update and patient.gender == 'O' %}selected{% endif %}>Otro</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="phone" class="form-label">Teléfono</label>
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           value="{% if is_update %}{{ patient.user.phone }}{% endif %}" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" 
                           value="{% if is_update %}{{ patient.user.email }}{% endif %}" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="insurance" class="form-label">Aseguradora</label>
                    <input type="text" class="form-control" id="insurance" name="insurance" 
                           value="{% if is_update %}{{ patient.insurance }}{% endif %}">
                </div>
            </div>
            
            {% if not is_update %}
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="username" class="form-label">Usuario</label>
                    <input type="text" class="form-control" id="username" name="username" required>
                    <small class="text-muted">Este será el usuario para iniciar sesión</small>
                </div>
            </div>
            {% endif %}
            
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="consent" name="consent" 
                           {% if is_update and patient.consent_given_at %}checked{% endif %}>
                    <label class="form-check-label" for="consent">
                        Acepto el tratamiento de mis datos personales
                    </label>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> {% if is_update %}Actualizar{% else %}Crear{% endif %} Paciente
            </button>
            <a href="{% url 'patient_list' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </form>
    </div>
</div>
{% endblock %}
